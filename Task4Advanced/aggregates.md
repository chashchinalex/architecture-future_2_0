# Описание Агрегатов (DDD Aggregates)

## 1. Контекст: Медицина (Medical Context)

### Агрегат: Patient (Пациент)
* **Границы:** Содержит личные данные, документы (СНИЛС), контакты.
* **Ключ:** `PatientID` (UUID).
* **Инварианты:**
    * Уникальность документов в системе.
    * История изменений персональных данных неизменяема (append-only log).

### Агрегат: MedicalVisit (Прием)
* **Границы:** Врач, Пациент, Услуги, Результат (Текстовое заключение + Код МКБ).
* **Ключ:** `VisitID` (UUID).
* **Инварианты:**
    * Визит нельзя закрыть без указания диагноза.
    * После подписания врачом (статус Signed) изменения запрещены.

## 2. Контекст: Финтех (Fintech Context)

### Агрегат: Invoice (Счет)
* **Границы:** Плательщик, Список услуг, Сумма, Срок оплаты.
* **Ключ:** `InvoiceID`.
* **Инварианты:**
    * Сумма не может быть отрицательной.
    * Статус меняется строго последовательно: New -> Pending -> Paid/Cancelled.

### Агрегат: Wallet (Счет клиента)
* **Границы:** Текущий баланс, Валюта, Ссылка на клиента.
* **Ключ:** `WalletID`.
* **Инварианты:**
    * Баланс не может быть меньше 0 (без подключенного овердрафта).
    * Принцип двойной записи при любых изменениях баланса.

## 3. Контекст: ИИ (AI Context)

### Агрегат: DiagnosticJob (Задание)
* **Границы:** Ссылка на файл (DICOM), Тип модели, Результат (Probability).
* **Ключ:** `JobID`.